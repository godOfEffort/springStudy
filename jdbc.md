## JDBC

### JDBC
애플리케이션 서버와 DB는 일반적으로 아래와 같이 3가지 과정을 거친다.
1. 커넥션 연결
2. SQL 전달
3. 결과 응답

`커넥션 연결` : 주로 TCP/IP를 사용해서 커넥션을 연결한다.

`SQL 전달`: 애플리케이션 서버는 DB가 이해할 수 있는 SQL을 연결된 커넥션을 통해 DB에 전달한다

`결과 응답` : DB는 전달된 SQL을 수행하고 그 결과를 응답한다.

문제는 각각의 데이터베이스 마다 커넥션을 연결하는 방법, SQL을 전달하는 방법, 결과를 응답받는 방법이 모두 다르다는 점이다.

### JDBC 표준 인터페이스
JDBC는 자바에서 데이터베이스에 접속할 수 있도록 하는 자바 API이다. 
JDBC는 데이터베이스에서 자료를 쿼리하거나 업데이틑 하는 방법을 제공한다.

JDBC의 등장으로 2가지 문제가 해결되었다.
1. 데이터베이스를 다른 종류의 데이터베이스로 변경하면 애플리케이션 서버의 데이터베이스 사용코드도 함께 변경해야 하는 문제
   -> **애플리케이션 로직은 JDBC 표준 인터페이스에만 의존하기 때문에 다른 데이터베이스로 변경시 JDBC구현 라이브러리만 변경하면 된다.**
2. 개발자가 각각의 데이터베이스마다 커넥션 연결, SQL 전달, 결과 응답을 새로 학습해야 하는 문제
   -> **개발자는 JDBC 표준 인터페이스 사용법만 학습하면 된다**

### JDBC와 최신 데이터 접근 기술
JDBC는 오래된 기술이고 최근에는 SQL Mapper 와 ORM 기술을 많이 사용한다.


## 커넥션풀과 데이터 소스 이해

### 커넥션 풀 이해
데이터베이스 커넥션을 획득할 때는 다음과 같은 복잡한 과정을 거친다.
1. 애플리케이션 로직은 DB 드라이버를 통해 커넥션을 조회한다.
2. DB 드라이버는 DB와 TCP/IP 커넥션을 연결한다. 물론 이 과정에서 3 way handshake 같은 TCP/IP연결을 위한 네트워크 동작이 발생
3. DB 드라이버는 TCP/IP 커넥션이 연결되면 ID, PW와 기타 부가정보를 DB에 전달한다.
4. DB는 ID, PW를 통해 내부인증을 완료하고, 내부에 DB세션을 생성한다.
5. DB는 커넥션 생성이 완료되었다는 응답을 보낸다.
6. DB 드라이버는 커넥션 객체를 생성해서 클라이언트에 반환한다.

이렇게 커넥션을 새로 만드는 것은 비효율적이기 때문에 커넥션을 미리 생성해두고 사용하는 커넥션 풀이 대안으로 등장했다.

커넥션 풀에 들어 있는 커넥션은 TCP/IP로 DB와 커넥션이 연결되어 있는 상태이기 때문에 언제든지 즉시 SQL을
DB에 전달할 수 있다.

### DataSource 이해
애플리케이션에서 DriverManager를 통해 커넥션을 획득하다가 HikariCP같은 커넥션 풀을 사용하도록
변경하려면 커넥션을 획득하는 애플리케이션 코드도 함께 변경해야 한다.

자바에서는 이런 문제를 해결하기 위해 **javax.sql.DataSource**라는 인터페이스를 제공한다.
DataSource는 커넥션을 획득하는 방법을 추상화하는 인터페이스이다.
이 인터페이스의 핵심 기능은 커넥션 조회 하나이다.

대부분의 커넥션 풀은 DataSource 인터페이스를 이미 구현해 두었다. 따라서 DataSource 인터페이스에만
의존하도록 애플리케이션 로직을 작성하면 된다.

DriverManager를 사용할 경우 DataSource를 사용하면 코드를 다 바꿔야 하는데 스프링은
DirverManagerDataSource라는 DataSource를 구현한 클래스를 제공한다.

**커넥션 풀에서 커넥션을 생성하는 작업은 애플리케이션 실행 속도에 영향을 주지 않기 위해 별도의
쓰레드에서 작동한다. 별도의 쓰레드에서 동작하기 때문에 테스트를 위해서는 Thread.sleep을 통해
대기시간을 주어야 한다.
